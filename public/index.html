<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MyVault - Personal Secure Archive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#020817" />

    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.webmanifest" />
  </head>
  <body>
    <div class="app-shell">
      <!-- HEADER -->
      <header class="app-header">
        <div class="logo">
          <div class="logo-circle">ğŸ”</div>
          <div>
            <h1>MyVault</h1>
            <p>Personal Secure Archive in your own Google Drive</p>
          </div>
        </div>
        <div class="header-actions">
          <div class="settings-inline">
            <select id="theme-select">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
              <option value="amoled">AMOLED</option>
              <option value="sepia">Sepia</option>
              <option value="ocean">Ocean</option>
            </select>
            <select id="font-select">
              <option value="sm">A-</option>
              <option value="md" selected>A</option>
              <option value="lg">A+</option>
            </select>
          </div>

          <button id="btn-signin" class="btn primary" disabled>
            Sign in with Google
          </button>
          <button id="btn-signout" class="btn ghost hidden">Sign Out</button>
        </div>
      </header>

      <!-- DASHBOARD CARDS -->
      <section class="card dashboard">
        <h2>Vault Overview</h2>
        <p class="hint">
          Quick view of your categories. Click a card â†’ enter Vault Password â†’
          see items in that group.
        </p>
        <div id="dashboard-cards" class="dash-grid">
          <!-- JS will render category cards here -->
        </div>
        <!-- <div id="vault-categories" class="vault-cat-grid"></div> -->
      </section>

      <!-- MAIN LAYOUT -->
      <main class="layout">
        <!-- LEFT: PASSWORD + UPLOAD -->
        <section class="panel">
          <h2>Vault Lock & Upload</h2>
          <p class="hint">
            â‘  Sign in with Google â‘¡ Set Vault Password â‘¢ Encrypt & Upload files
            into your MyVault.
          </p>

          <!-- Vault Password -->
          <div class="card">
            <label class="label">Vault Password</label>
            <input
              type="password"
              id="vault-password"
              placeholder="Choose a strong password"
            />
            <p class="mini-hint">
              This password never leaves your browser. It encrypts & decrypts
              your files.
              <strong>Do not forget it.</strong>
            </p>
            <p id="vault-password-status" class="status"></p>
            <button id="btn-lock" class="btn small ghost" type="button">
              ğŸ”’ Use this password
            </button>
          </div>

          <!-- Upload Form -->
          <form id="upload-form" class="card">
            <h3>Upload New Item</h3>

            <div class="form-row">
              <label>Title</label>
              <input
                type="text"
                id="file-title"
                placeholder="e.g. 2024 Tax Return"
                required
              />
            </div>

            <div class="form-row">
              <label>Category</label>
              <select id="file-category">
                <option value="ids">IDs & Identity</option>
                <option value="immigration">Immigration & Status</option>
                <option value="legal">Legal Documents</option>
                <option value="tax">Tax Returns</option>
                <option value="payment">Finance & Payments</option>
                <option value="housing">Housing / Lease / Mortgage</option>
                <option value="vehicles">Vehicles & Driving</option>
                <option value="health">Health & Medical</option>
                <option value="work">Work & Employment</option>
                <option value="education">Education & Certificates</option>
                <option value="business">Business / LLC</option>
                <option value="membership">Memberships & Cards</option>
                <option value="receipts">Receipts & Warranty</option>
                <option value="photos">Photos & Albums</option>
                <option value="applicationa">Applications & Forms</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-row" id="album-row" style="display: none">
              <label>Album (for photos)</label>
              <input
                type="text"
                id="file-album"
                placeholder="e.g. Family 2025, Documents Scan"
              />
            </div>

            <div class="form-row">
              <label>Tags</label>
              <input
                type="text"
                id="file-tags"
                placeholder="e.g. 2024, IRS, car, house"
              />
            </div>

            <div class="form-row">
              <label>Date</label>
              <input type="date" id="file-date" />
              <button
                type="button"
                id="btn-date-picker"
                class="btn small ghost"
                title="Pick a date"
              >
                ğŸ“…
              </button>
              <button
                type="button"
                id="btn-date-today"
                class="btn small ghost"
                title="Today"
              >
                Today
              </button>
              <button
                type="button"
                id="btn-date-clear"
                class="btn small ghost"
                title="Clear"
              >
                Clear
              </button>
            </div>

            <div class="form-row">
              <label>File</label>
              <input type="file" id="file-input" multiple required />
            </div>

            <button type="submit" class="btn full primary">
              Encrypt & Upload to MyVault
            </button>
            <p id="upload-status" class="status"></p>
          </form>
        </section>

        <!-- RIGHT: LIST + ACTIVITY -->
        <section class="panel">
          <h2>Your Vault (All Items)</h2>

          <div class="card">
            <div class="search-row">
              <input
                type="text"
                id="search-input"
                placeholder="Search by title, tags, album..."
              />
              <select id="filter-category">
                <option value="">All</option>
                <option value="ids">IDs</option>
                <option value="immigration">Immigration</option>
                <option value="legal">Legal</option>
                <option value="tax">Tax</option>
                <option value="payment">Finance / Payments</option>
                <option value="housing">Housing</option>
                <option value="vehicles">Vehicles</option>
                <option value="health">Health</option>
                <option value="work">Work</option>
                <option value="education">Education</option>
                <option value="business">Business</option>
                <option value="membership">Memberships</option>
                <option value="receipts">Receipts</option>
                <option value="photos">Photos</option>
                <option value="applicationa">Applications / Forms</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div id="vault-list" class="vault-list card">
            <p class="hint">
              Sign in with Google to load your encrypted items.
            </p>
          </div>

          <div class="card soft">
            <h3>Activity Log</h3>
            <ul id="activity-list" class="mini-list"></ul>
          </div>
        </section>

        <!-- Help / Guide Tab -->
        <section id="tab-help" class="tab-panel hidden">
          <div class="card">
            <!-- CLOSE BUTTON -->
            <button type="button" class="drawer-close" onclick="closeDrawer()">
              âœ•
            </button>
            <h2>MyVault â€“ User Guide</h2>
            <p>
              á€¡á€±á€¬á€€á€ºá€€á€¡á€á€­á€¯á€„á€ºá€¸ MyVault app á€€á€­á€¯ á€á€„á€ºá€·á€€á€­á€¯á€šá€ºá€•á€­á€¯á€„á€º á€€á€¬á€€á€½á€šá€ºá€‘á€¬á€¸á€á€²á€· vault
              á€œá€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
            </p>

            <h3>1. á€•á€‘á€™á€†á€¯á€¶á€¸ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€²á€·á€¡á€á€«</h3>
            <ol>
              <li>
                <strong>Sign in with Google</strong> â€“ á€á€œá€¯á€á€ºá€€á€­á€¯á€”á€¾á€­á€•á€ºá€•á€¼á€®á€¸ Google
                popup á€‘á€²á€™á€¾á€¬ Drive access á€€á€­á€¯ Allow á€œá€¯á€•á€ºá€•á€«á‹
              </li>
              <li>
                <strong>Vault Password á€á€á€ºá€™á€¾á€á€ºá€›á€”á€º</strong> â€“ Vault password á€€á€­á€¯
                á€‘á€Šá€·á€ºá€‘á€¬á€¸á€›á€•á€«á€™á€šá€ºá‹ á€’á€® password á€á€¬á€œá€»á€¾á€„á€º á€–á€­á€¯á€„á€ºá€á€½á€±á€€á€­á€¯ decrypt
                á€œá€¯á€•á€ºá€–á€­á€¯á€·á€œá€­á€¯á€•á€«á€á€šá€ºá‹ á€™á€±á€·á€á€½á€¬á€¸á€›á€„á€º á€–á€­á€¯á€„á€ºá€Ÿá€±á€¬á€„á€ºá€¸á€á€½á€±á€€á€­á€¯ á€–á€¼á€±á€–á€­á€¯á€·á€™á€›á€á€±á€¬á€·á€•á€«á‹
              </li>
            </ol>

            <h3>2. Encrypt &amp; Upload á€œá€¯á€•á€ºá€”á€Šá€ºá€¸</h3>
            <ol>
              <li>
                <strong>Form á€–á€¼á€Šá€·á€ºá€›á€”á€º</strong> â€“ Title, Category, Date, Album
                (Photos á€¡á€á€½á€€á€º), Tags á€€á€­á€¯á€œá€­á€¯á€á€œá€­á€¯á€–á€¼á€Šá€·á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
              </li>
              <li>
                <strong>Choose Files</strong> â€“ PDF, Image, DOCX á€…á€á€²á€·
                á€–á€­á€¯á€„á€ºá€á€½á€±á€€á€­á€¯ á€á€…á€ºá€á€«á€á€Šá€ºá€¸ á€¡á€™á€»á€¬á€¸á€€á€¼á€®á€¸á€›á€½á€±á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
              </li>
              <li>
                <strong>Encrypt &amp; Upload</strong> â€“ á€á€œá€¯á€á€ºá€€á€­á€¯á€”á€¾á€­á€•á€ºá€œá€­á€¯á€€á€ºá€›á€„á€º:
                <ul>
                  <li>Browser á€‘á€²á€™á€¾á€¬ AES-GCM á€”á€²á€· encrypt á€œá€¯á€•á€ºá€™á€šá€º</li>
                  <li>
                    Encrypted blob á€€á€­á€¯ Google Drive MyVault folder á€‘á€² upload
                    á€œá€¯á€•á€ºá€™á€šá€º
                  </li>
                  <li>
                    <code>vault_meta.json</code> á€‘á€²á€™á€¾á€¬ metadata (id / title /
                    category / tags / iv / salt â€¦) á€á€­á€™á€ºá€¸á€™á€šá€º
                  </li>
                </ul>
              </li>
            </ol>

            <h3>3. Files á€€á€­á€¯ á€•á€¼á€”á€ºá€›á€¾á€¬á€•á€¼á€®á€¸ á€€á€¼á€Šá€·á€ºá€”á€Šá€ºá€¸</h3>
            <ul>
              <li>
                <strong>Dashboard</strong> â€“ Category card á€á€½á€± (Tax, IDs,
                Businessâ€¦) á€á€á€ºá€™á€¾á€á€ºá€‘á€¬á€¸á€á€²á€· count á€€á€­á€¯á€™á€¼á€„á€ºá€›á€™á€šá€ºá‹
              </li>
              <li>
                <strong>Search &amp; Filter</strong> â€“ á€œá€°á€€á€¼á€­á€¯á€€á€ºá€¡á€–á€¼á€¬ title / tag
                / category á€”á€²á€· filter á€œá€¯á€•á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
              </li>
              <li>
                <strong>Preview</strong> â€“ Row á€™á€¾á€¬ <em>Preview</em> á€€á€­á€¯á€”á€¾á€­á€•á€ºá€›á€„á€º
                Vault password á€”á€²á€· decrypt á€œá€¯á€•á€ºá€•á€¼á€®á€¸ PDF / Image á€€á€­á€¯ app á€¡á€á€½á€„á€ºá€¸
                á€™á€¾á€”á€ºá€€á€”á€ºá€á€²á€· viewer á€”á€²á€· á€•á€¼á€•á€±á€¸á€™á€šá€ºá‹
              </li>
              <li>
                <strong>Download</strong> â€“ <em>Download</em> á€€á€­á€¯á€”á€¾á€­á€•á€ºá€›á€„á€º
                decrypt á€œá€¯á€•á€ºá€•á€¼á€®á€¸ original file type á€”á€²á€· á€á€»á€€á€ºá€á€»á€„á€ºá€¸ download
                á€œá€¯á€•á€ºá€•á€±á€¸á€™á€šá€ºá‹
              </li>
            </ul>

            <h3>4. Photos &amp; Albums</h3>
            <ul>
              <li>
                Category á€€á€­á€¯ <strong>Photos</strong> á€œá€­á€¯á€·á€›á€½á€±á€¸á€‘á€¬á€¸á€á€²á€· á€–á€­á€¯á€„á€ºá€á€½á€±á€™á€¾á€¬
                Album field á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
              </li>
              <li>
                Photos tab / Category modal á€‘á€²á€€ album á€¡á€œá€­á€¯á€€á€º gallery (grid)
                á€”á€²á€·á€œá€Šá€ºá€¸ á€•á€¼á€•á€±á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º (upgrade á€™á€­á€á€šá€ºá€†á€­á€¯á€›á€„á€º).
              </li>
            </ul>

            <h3>5. Vault Password á€•á€¼á€”á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€á€»á€„á€ºá€›á€„á€º</h3>
            <ul>
              <li>
                Settings á€‘á€²á€€ <em>Change Vault Password</em> UI á€™á€¾á€¬ Old + New
                password á€‘á€Šá€·á€ºá€•á€¼á€®á€¸ confirm á€œá€¯á€•á€ºá€•á€«á‹
              </li>
              <li>
                App á€€ metadata entry á€á€…á€ºá€á€¯á€á€»á€„á€ºá€¸á€…á€®á€¡á€á€½á€€á€º
                <ol>
                  <li>Old password á€”á€²á€· decrypt</li>
                  <li>New password á€”á€²á€· re-encrypt</li>
                  <li>
                    Drive á€‘á€²á€›á€¾á€­ encrypted file content á€€á€­á€¯ media upload á€”á€²á€·
                    PATCH á€œá€¯á€•á€ºá€™á€šá€º
                  </li>
                  <li>iv / salt á€€á€­á€¯ metadata á€‘á€² update &amp; save á€œá€¯á€•á€ºá€™á€šá€º</li>
                </ol>
              </li>
            </ul>

            <hr />

            <h2>Developer Notes (Admin á€¡á€á€½á€€á€º)</h2>
            <h3>Architecture</h3>
            <ul>
              <li>
                <strong>Frontend only</strong> â€“ HTML + CSS + vanilla JS á€á€¬á€á€¯á€¶á€¸,
                backend server á€™á€œá€­á€¯
              </li>
              <li>
                <strong>Auth</strong> â€“ Google Identity Services (GIS) á€”á€²á€·
                OAuth2 access token á€›á€šá€°
              </li>
              <li>
                <strong>Storage</strong> â€“ Google Drive API v3 á€á€¼á€„á€º
                <ul>
                  <li>Encrypted file data (.enc) â†’ MyVault folder</li>
                  <li><code>vault_meta.json</code> â†’ metadata array</li>
                  <li>
                    <code>localStorage["myvault_meta_cache"]</code> â†’ UI cache
                    (refresh-safe)
                  </li>
                </ul>
              </li>
            </ul>

            <h3>Metadata Structure</h3>
            <pre><code>{
  id: "drive-file-id",
  title: "2024 Tax Return",
  category: "tax",
  tags: ["tax", "2024", "irs"],
  album: "2024",
  date: "2024-04-15",
  originalName: "2024_tax_return.pdf",
  size: 123456,
  mimeType: "application/pdf",
  iv: "base64-iv",
  salt: "base64-salt",
  createdAt: "2024-04-16T12:34:56.789Z",
  logs: [
    { type: "upload", ts: "2024-04-16T12:34:56.789Z" },
    { type: "rekey",  ts: "2025-01-01T09:00:00.000Z" }
  ]
}</code></pre>

            <h3>Category á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€”á€Šá€ºá€¸ (short)</h3>
            <ol>
              <li>
                <strong>app.js / CATEGORY_CONFIG</strong> á€‘á€²á€€ object á€‘á€²á€€á€­á€¯ key
                á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€•á€« (á€¥á€•á€™á€¬ <code>medical</code>):
              </li>
            </ol>
            <pre><code>const CATEGORY_CONFIG = {
  tax:     { label: "Tax Returns",     icon: "ğŸ“„", color: "#38bdf8" },
  ...
  medical: { label: "Medical Records", icon: "ğŸ©º", color: "#10b981" },
  other:   { label: "Other",           icon: "ğŸ“", color: "#9ca3af" },
};</code></pre>

            <ol start="2">
              <li>
                <strong>index.html</strong> á€‘á€²á€€
                <code>&lt;select id="file-category"&gt;</code>,
                <code>filter-category</code>, <code>edit-category</code> á€á€½á€„á€º
                <code
                  >&lt;option value="medical"&gt;Medical
                  Records&lt;/option&gt;</code
                >
                á€‘á€•á€ºá€‘á€Šá€·á€ºá€•á€«á‹
              </li>
              <li>
                Upload handler á€‘á€²á€™á€¾á€¬
                <code>category = getCategoryConf(category).key;</code> á€”á€²á€·
                normalize á€œá€¯á€•á€ºá€‘á€¬á€¸á€á€œá€±á€¬á€€á€ºáŠ unknown valuesë“¤ì€
                <code>other</code> á€€á€­á€¯ default á€á€á€ºá€™á€šá€ºá‹
              </li>
            </ol>
          </div>
        </section>

        <!-- Developer Panel Tab (Admin only) -->
        <section id="tab-dev" class="tab-panel hidden">
          <div class="card">
            <!-- CLOSE BUTTON -->
            <button type="button" class="drawer-close" onclick="closeDrawer()">
              âœ•
            </button>
            <h2>Developer Panel (Admin Only)</h2>
            <p class="hint">
              á€’á€®á€á€”á€ºá€¸á€€ á€€á€­á€¯á€šá€ºá€á€­á€¯á€„á€ºá€á€¯á€¶á€¸á€–á€­á€¯á€·á€¡á€á€±á€¬á€ºá€•á€²á€”á€±á€¬á€º â€“ metadata / cache / debug
              á€€á€­á€¯á€…á€…á€ºá€€á€¼á€Šá€·á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€ºá‹
            </p>

            <div class="dev-row">
              <label>
                <input type="checkbox" id="dev-debug-toggle" />
                Enable console debug logs (MV_DEBUG)
              </label>
            </div>

            <div class="dev-row">
              <button type="button" id="dev-btn-dump-meta" class="btn small">
                Show metadata[]
              </button>
              <button type="button" id="dev-btn-dump-cache" class="btn small">
                Show localStorage cache
              </button>
              <button type="button" id="dev-btn-reload-meta" class="btn small">
                Reload metadata from Drive
              </button>
              <button
                type="button"
                id="dev-btn-clear-cache"
                class="btn small danger"
              >
                Clear local cache
              </button>
            </div>

            <h3>metadata[] (live in memory)</h3>
            <textarea
              id="dev-meta-json"
              class="dev-textarea"
              readonly
            ></textarea>

            <h3>localStorage["myvault_meta_cache"]</h3>
            <textarea
              id="dev-cache-json"
              class="dev-textarea"
              readonly
            ></textarea>
          </div>
        </section>

        <!-- SETTINGS TAB -->
        <section id="tab-settings" class="tab-panel hidden">
          <div class="card">
            <button type="button" class="drawer-close" onclick="closeDrawer()">
              âœ•
            </button>
            <h2>Settings</h2>

            <h3>Change Vault Password</h3>
            <p class="hint">
              Old password á€”á€²á€· decrypt â†’ New password á€”á€²á€· re-encrypt â†’ Drive
              á€‘á€²á€€á€­á€¯ update á€•á€¼á€”á€ºá€á€„á€ºá€á€½á€¬á€¸á€™á€šá€ºá‹
            </p>

            <div class="form-row">
              <label>Old Password</label>
              <input type="password" id="old-vault-pw" />
            </div>

            <div class="form-row">
              <label>New Password</label>
              <input type="password" id="new-vault-pw" />
            </div>

            <button class="btn primary full" id="btn-change-vault-password">
              Change Password
            </button>

            <p id="settings-status" class="status"></p>
          </div>
        </section>
      </main>
      <footer class="footer-bar">
        <button class="footer-btn" data-tab="help">Help / Guide</button>
        <button class="footer-btn" data-tab="dev">Dev Panel</button>
        <button class="footer-btn" data-tab="settings">Settings</button>
      </footer>
    </div>

    <!-- CATEGORY MODAL -->
    <div id="category-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title"></h3>
          <button id="modal-close" class="btn small ghost">âœ•</button>
        </div>
        <div id="modal-body" class="modal-body">
          <!-- Filled by JS -->
        </div>
      </div>
    </div>

    <!-- PREVIEW MODAL -->
    <div id="preview-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="preview-title">Preview</h3>
          <div class="actions">
            <button id="pdf-zoom-out" class="btn small ghost" title="Zoom out">
              âˆ’
            </button>
            <button id="pdf-zoom-in" class="btn small ghost" title="Zoom in">
              ï¼‹
            </button>
            <button
              id="pdf-open-tab"
              class="btn small ghost"
              title="Open in new tab"
            >
              â†—
            </button>
            <button id="preview-expand" class="btn small" title="Expand">
              â†”
            </button>
            <button id="preview-close" class="btn small ghost">âœ•</button>
          </div>
        </div>
        <div id="preview-body" class="modal-body preview-body">
          <!-- filled by JS -->
        </div>
      </div>
    </div>

    <!-- EDIT MODAL -->
    <div id="edit-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Item</h3>
          <button id="edit-close" class="btn small ghost">âœ•</button>
        </div>
        <div class="modal-body">
          <form id="edit-form" class="edit-form">
            <input type="hidden" id="edit-id" />
            <div class="form-row">
              <label class="label">Title</label>
              <input type="text" id="edit-title" />
            </div>
            <div class="form-row">
              <label class="label">Category</label>
              <select id="edit-category">
                <option value="ids">IDs & Identity</option>
                <option value="immigration">Immigration & Status</option>
                <option value="legal">Legal Documents</option>
                <option value="tax">Tax Returns</option>
                <option value="payment">Finance & Payments</option>
                <option value="housing">Housing / Lease</option>
                <option value="vehicles">Vehicles & Driving</option>
                <option value="health">Health & Medical</option>
                <option value="work">Work & Employment</option>
                <option value="education">Education & Certificates</option>
                <option value="business">Business / LLC</option>
                <option value="membership">Memberships & Cards</option>
                <option value="receipts">Receipts & Warranty</option>
                <option value="photos">Photos & Albums</option>
                <option value="applicationa">Applications & Forms</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-row">
              <label class="label">Album (photos)</label>
              <input type="text" id="edit-album" />
            </div>
            <div class="form-row">
              <label class="label">Tags (comma separated)</label>
              <input type="text" id="edit-tags" />
            </div>
            <div class="form-row">
              <label class="label">Date</label>
              <input type="date" id="edit-date" />
            </div>
            <button type="submit" class="btn full primary">Save changes</button>
            <p id="edit-status" class="status"></p>
          </form>
        </div>
      </div>
    </div>

    <script src="app.js"></script>

    <!-- Google APIs (loaded last) -->
    <script
      src="https://apis.google.com/js/api.js"
      async
      defer
      onload="gapiLoaded()"
    ></script>
    <script
      src="https://accounts.google.com/gsi/client"
      async
      defer
      onload="gisLoaded()"
    ></script>

    <script>
      // Register service worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("./sw.js").catch(console.error);
      }
    </script>
  </body>
</html>
